# Set GitHub Secrets and trigger macOS release workflow

This file documents the safe steps to add the required GitHub Actions secrets and trigger the `macos-release.yml` workflow.

Prerequisites

- `gh` (GitHub CLI) installed and authenticated with permission to manage repository secrets and workflows.
- The signing certificates and App Store Connect JSON key available locally.

1) Prepare secrets locally

- Convert a `.p12` certificate to base64 (one-liner):

```bash
./scripts/p12_to_base64.sh /path/to/AppleDistribution.p12 > /tmp/app_signing.p12.base64
APP_SIGNING_P12_BASE64=$(cat /tmp/app_signing.p12.base64)
export APP_SIGNING_P12="$APP_SIGNING_P12_BASE64"
export APP_SIGNING_P12_PASSWORD='your-p12-password'
```

- Prepare App Store Connect API key JSON (minify to single-line):

```bash
APP_STORE_CONNECT_API_KEY_JSON=$(jq -c . /path/to/AuthKey.json)
export APP_STORE_CONNECT_API_KEY_JSON
export APP_STORE_CONNECT_KEY_ID='KEYID'
export APP_STORE_CONNECT_ISSUER_ID='ISSUERID'
```

2) Use the helper script to upload secrets

The repository already includes `scripts/gh_set_secrets.sh`. It reads the environment variables named below and uploads them using `gh secret set`.

Secrets expected by the workflow (exact names):

- APP_SIGNING_P12
- APP_SIGNING_P12_PASSWORD
- INSTALLER_P12
- INSTALLER_P12_PASSWORD
- SIGN_IDENTITY
- INSTALLER_IDENTITY
- APP_STORE_CONNECT_API_KEY_JSON
- APP_STORE_CONNECT_KEY_ID
- APP_STORE_CONNECT_ISSUER_ID

Run the helper (after exporting variables):

```bash
export REPO="$(git remote get-url origin | sed -n 's#.*/\(.*\)\.git#\1#p')"
./scripts/gh_set_secrets.sh
```

Note: the script will skip any variable that is empty and will print which secrets were uploaded.

3) Trigger the workflow (manual dispatch)

After secrets are present, trigger the workflow via the GitHub UI or with CLI:

```bash
# Example: run with defaults
gh workflow run macos-release.yml --ref main

# Or pass inputs
gh workflow run macos-release.yml --ref main \
  -f app_name="Time Warp" -f executable_name="time-warp" -f bundle_id="org.honeybadger.timewarp" -f version="0.0.1" -f build_version="1"
```

4) Troubleshooting & editor warnings

- The YAML language server may still show "Context access might be invalid" for secret names until the secrets are visible to GitHub. This is informational.
- If you see stale "'name' is already defined" or duplicate parsing diagnostics in VS Code after file edits, reload the window: `Developer: Reload Window` or restart the YAML language server.

If you want, I can prepare the `gh secret set` commands directly here (but you must provide secret values or base64 outputs). I will not upload any secret values unless you explicitly provide them.

---
Generated by automation helper.
